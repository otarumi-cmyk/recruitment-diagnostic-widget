<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>人気300企業 転職可能性診断</title>
  <style>
    :root {
      --bg: #f8f7f4;
      --panel: #ffffff;
      --border: #e9e5dd;
      --primary: #ff6b03;
      --primary-2: #ffa347;
      --text: #1f2933;
      --muted: #6b7280;
      --radius: 16px;
      --font: 'Inter', 'Noto Sans JP', system-ui, -apple-system, sans-serif;
      --shadow: 0 16px 40px rgba(0,0,0,0.10);
      --shadow-soft: 0 8px 20px rgba(0,0,0,0.06);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font);
      background: radial-gradient(circle at 20% 20%, rgba(255,107,3,0.07), transparent 26%),
                  radial-gradient(circle at 80% 0%, rgba(255,163,71,0.08), transparent 22%),
                  var(--bg);
      color: var(--text);
      padding: 24px;
    }
    .shell {
      max-width: 1080px;
      margin: 0 auto;
      display: grid;
      gap: 20px;
    }
    .hero {
      padding: 24px 28px;
      background: linear-gradient(135deg, rgba(255,107,3,0.10), rgba(255,163,71,0.10));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
    }
    .hero h1 { margin: 0 0 8px; font-size: 24px; letter-spacing: 0.01em; }
    .hero p { margin: 4px 0; color: var(--muted); }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 20px;
    }
    .question-card {
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: #fffaf5;
      margin-bottom: 12px;
    }
    .question-title { margin: 0 0 8px; font-weight: 700; }
    .options { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; }
    .opt {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #ffffff;
      cursor: pointer;
      transition: all 0.15s ease;
      color: var(--text);
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    }
    .opt:hover { border-color: var(--primary); transform: translateY(-1px); }
    .opt.active { border-color: var(--primary); background: #fff2e7; box-shadow: 0 6px 14px rgba(255,107,3,0.18); color: #7a2f00; }
    .nav { display: flex; justify-content: space-between; gap: 10px; margin-top: 12px; }
    .btn {
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: #fff;
      box-shadow: 0 10px 24px rgba(255,107,3,0.26);
    }
    .btn-primary:hover { filter: brightness(1.05); transform: translateY(-1px); }
    .btn-secondary {
      background: #fff;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    .progress-wrap { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .progress { flex: 1; height: 10px; background: #f4ede5; border-radius: 999px; overflow: hidden; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--primary-2)); transition: width 0.2s ease; }
    .progress-text { font-size: 13px; color: var(--muted); min-width: 110px; text-align: right; }
    .result-list { display: flex; flex-direction: column; gap: 10px; max-height: 540px; overflow: auto; padding-right: 4px; }
    .meter {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fffaf5;
    }
    .meter-bar {
      position: relative;
      width: 100%;
      height: 12px;
      background: #f4ede5;
      border-radius: 999px;
      overflow: hidden;
    }
    .meter-fill { position: absolute; inset: 0; width: 20%; border-radius: 999px; }
    .tag { padding: 4px 8px; border-radius: 999px; font-size: 12px; font-weight: 700; border: 1px solid var(--border); }
    .muted { color: var(--muted); font-size: 14px; }
    .bar-row { margin: 10px 0; }
    .bar-head { display: flex; justify-content: space-between; font-size: 13px; color: var(--muted); }
    .bar-track { width: 100%; height: 14px; background: #f4ede5; border-radius: 999px; overflow: hidden; }
    .bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary-2)); border-radius: 999px; width: var(--w, 0%); animation: barGrow 0.8s ease forwards; transform-origin: left; }
    @keyframes barGrow { from { width: 0%; } to { width: var(--w, 0%); } }
    .radar-poly { transform-origin: center; animation: radarGrow 0.9s ease-out forwards; opacity: 0; }
    .radar-label { animation: fadeIn 0.8s ease-out forwards; opacity: 0; }
    @keyframes radarGrow { from { transform: scale(0.2); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @media (max-width: 960px) { /* single column by design */ }
    @media (max-width: 640px) {
      body { padding: 16px; }
      .hero { padding: 18px; }
      .options { grid-template-columns: 1fr; }
      .btn { width: 100%; text-align: center; }
      .nav { flex-direction: column; }
      .progress-text { min-width: 72px; font-size: 12px; }
      .meter { padding: 10px; }
      .meter div { font-size: 14px; }
      .meter .tag { font-size: 11px; }
      .result-list { max-height: 360px; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="hero">
      <h1>人気300企業 転職可能性診断</h1>
      <p></p>
    </div>

    <div class="panel">
      <div class="progress-wrap">
        <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="progress-text" id="progress-text">0/20 (0%)</div>
      </div>
      <div class="error" id="error-message" style="display:none; color:#ef4444; margin-bottom:12px;"></div>
      <div id="form-area"></div>
    </div>
  </div>

  <script type="module">
    // 設問定義（20問）- 改善版：具体的・客観的・偏見を排除
    const questions = [
      { id: 'Q1', title: '年齢を教えてください', options: ['20代', '30代', '40代', '50代', '60代以上'] },
      { id: 'Q2', title: '現在の職種はどれに該当しますか', options: ['一般事務・アシスタント', '営業・セールス', 'マーケティング・企画・PdM', 'IT・エンジニア', 'AI・データ・高度専門職', 'その他専門職'] },
      { id: 'Q3', title: '現在の役職・職位はどれに該当しますか', options: ['一般職', 'リーダー・主任', 'マネージャー', '部長・ディレクター', '事業責任者・役員'] },
      { id: 'Q4', title: '現在の年収はどれに該当しますか', options: ['〜300万円', '300〜400万円', '400〜600万円', '600〜800万円', '800〜1000万円', '1000万円以上'] },
      { id: 'Q5', title: '現在の業種は？', options: ['IT・通信', '製造業・自動車', '金融・保険', '商社・流通', '食品・飲料', '建設・不動産', 'メディア・エンターテインメント', '医薬品・化学', 'サービス・コンサル', '小売・流通', '運輸・物流', 'エネルギー', '化粧品・日用品', '公的機関', 'その他'] },
      { id: 'Q6', title: '過去1年間で達成した具体的な成果はありますか（売上・利益・コスト削減・ユーザー数など）', options: ['成果なし', '定性的な成果のみ', '一部で数値目標を達成', '主要な数値目標を達成', '数値目標を大幅に達成'] },
      { id: 'Q7', title: '月間の売り上げは？', options: ['なし（売上に関与していない）', '30万円未満', '30万円〜50万円', '50万円〜100万円', '100万円〜200万円', '200万円〜500万円', '500万円〜1000万円', '1000万円以上'] },
      { id: 'Q8', title: '担当している業務の範囲は', options: ['単一業務のみ', '複数業務を担当', '部門横断プロジェクトに参加', '事業全体に関わる業務'] },
      { id: 'Q9', title: '業務上の意思決定権限はどの程度ありますか', options: ['指示された業務を実行', '一部の業務で自律判断', '担当領域で意思決定', '戦略レベルの意思決定'] },
      { id: 'Q10', title: '現在の会社での在籍年数は', options: ['1年未満', '1〜3年', '3〜5年', '5〜10年', '10年以上'] },
      { id: 'Q11', title: '転職回数は（現在の会社を含む）', options: ['1社のみ（転職経験なし）', '2社', '3社', '4社', '5社以上'] },
      { id: 'Q12', title: '最終学歴は', options: ['高卒・専門卒', '日東駒専・地方国公立', 'MARCH・関関同立', '早慶', '旧帝大・海外トップ大'] },
      { id: 'Q13', title: '保有している資格は（複数該当可）', options: ['資格なし', 'TOEIC（700点以上）・簿記2級・基本情報技術者など', '税理士・公認会計士・弁護士・医師・薬剤師・中小企業診断士・社会保険労務士・行政書士・宅建士など'] },
      { id: 'Q14', title: 'チャレンジ精神・挑戦意欲は？', options: ['現状維持志向', '時々新しいことに挑戦', '積極的に新しいことに挑戦', '常に新しい挑戦を求めている'] },
      { id: 'Q15', title: 'ストレス耐性・柔軟性は？', options: ['ストレスに弱い・変化が苦手', '普通', 'ストレスに強い・変化に対応できる', '高いストレス耐性・変化を楽しめる'] },
      { id: 'Q16', title: '主体性・責任感は？', options: ['指示待ちが多い', '一部で自発的に行動', '自発的に行動し責任を持って遂行', '高い主体性で結果に責任を持つ'] },
      { id: 'Q17', title: 'プログラミング・デジタルツールの活用経験は', options: ['ほぼ使えない', 'Excel・Wordなど一般ツール', '業務改善でツールを活用', 'プログラミング・AI活用で成果を出している'] },
      { id: 'Q18', title: 'プロジェクト管理・推進経験は？', options: ['経験なし', '小規模プロジェクト（3名以下）', '中規模プロジェクト（5〜10名）', '大規模プロジェクト（10名以上）', '複数プロジェクトを同時管理', '事業レベルのプロジェクトを主導'] },
      { id: 'Q19', title: '社内外のステークホルダーとの調整・交渉経験は', options: ['経験なし', '社内のみ', '社外との調整経験あり', '社内外の重要な交渉を担当'] },
      { id: 'Q20', title: '学習意欲・成長志向は？', options: ['現状維持志向', '必要に応じて学ぶ', '積極的にスキルアップしている', '常に新しい知識・スキルを習得している'] },
    ];

    // 企業リスト（300社）
    const companies = [
      // 1-50
      'トヨタ自動車','グーグル','ソニー','楽天グループ','キーエンス','任天堂','パナソニック','アマゾンジャパン','Apple Japan','伊藤忠商事',
      '三菱商事','ソフトバンク','本田技研工業（Honda）','味の素','全日本空輸（ANA）','サントリーホールディングス','東日本電信電話（NTT東日本）','ファーストリテイリング','西日本電信電話（NTT西日本）','日本航空（JAL）',
      '日本マイクロソフト','リクルートホールディングス','LINEヤフー','オリエンタルランド','東日本旅客鉄道（JR東日本）','三井物産','資生堂','明治','イオン','アクセンチュア',
      '東海旅客鉄道（JR東海）','カゴメ','日立製作所','NTTドコモ','花王','NTTデータ','日本電気（NEC）','電通','富士通','東京海上日動火災保険',
      'バンダイナムコホールディングス','デンソー','三井不動産','バンダイ','KDDI','未来工業','JTB','フジテレビジョン','武田薬品工業','日本たばこ産業（JT）',
      // 51-100
      '丸紅','JR西日本','ニトリ','東芝','NRI（野村総合研究所）','ZOZO','富士フイルム','良品計画','IBM Japan','キヤノン',
      'カルビー','三菱UFJ銀行','東京エレクトロン','村田製作所','日本中央競馬会（JRA）','AGC','サイバーエージェント','日産自動車','オムロン','旭化成',
      '三菱地所','スターバックス コーヒー ジャパン','三菱電機','日本コカ・コーラ','キリンホールディングス','TOTO','タニタ','DeNA','積水ハウス','ゴールドマン・サックス',
      'アステラス製薬','集英社','日本郵船','日本テレビ（NTV）','みずほ銀行','クボタ','住友商事','サンリオ','三菱重工','第一三共',
      '日本銀行','三井住友銀行','スクウェア・エニックス','サイボウズ','清水建設','アサヒビール','シャープ','博報堂','マツダ','鹿島建設',
      // 101-150
      'しまむら','セガサミーHD','NHK','日本製鉄','キユーピー','大林組','江崎グリコ','ローソン','大成建設','京セラ',
      'テスラ','ウォルト・ディズニー・ジャパン','OpenAI','大和ハウス工業','ヤクルト本社','東京都庁','ヤマハ','ブルボン','スズキ','Meta',
      '竹中工務店','メルカリ','アイシン','SUBARU','キッコーマン','マッキンゼー','ファナック','東レ','中外製薬','九州電力',
      '講談社','野村證券','タカラトミー','ベネッセコーポレーション','信越化学','日清食品','ロッテ','セイコーエプソン','阪神タイガース','不二家',
      'ダイキン工業','コナミグループ','日本マクドナルド','アイリスオーヤマ','日本生命保険','コクヨ','日本赤十字社','JR九州','ニデック','デロイトトーマツコンサルティング',
      // 151-200
      '森永製菓','セブン-イレブン・ジャパン','日本郵便','JAXA','SCSK','コーセー','P&Gジャパン','キリンビール','山崎製パン','川崎重工',
      'TOPPAN','Sky（スカイ）','日本ガイシ','IHI','ファンケル','伊藤園','阪急電鉄','大塚製薬','サッポロビール','吉本興業HD',
      '住友林業','タミヤ','森ビル','三菱ケミカル','コストコ','TBS','ジャパネットたかた','読売ジャイアンツ','佐川急便','東京メトロ',
      'ユニバーサルミュージック','東宝','第一生命','マツモトキヨシ','東北電力','島津製作所','ダイハツ工業','モンベル','エーザイ','HIS',
      'Alphabet','Nike Japan','ファミリーマート','PwC','BCG','テレビ朝日','レゴジャパン','日本オラクル','北海道電力','関西電力',
      // 201-250
      'マイナビ','MIXI','大創産業（ダイソー）','東京電力','すかいらーくHD','大日本印刷','ヤマハ発動機','東急電鉄','横浜DeNAベイスターズ','ルイ・ヴィトン・ジャパン',
      '刀','コーエーテクモHD','ワコール','オリックス','塩野義製薬','シマノ','ミツカン','中部電力','ディスコ','星野リゾート',
      '湖池屋','ANYCOLOR','NTTコミュニケーションズ','日本通運','経済産業省','理化学研究所','中国銀行（中銀）','帝国ホテル','リコー','西日本鉄道',
      '住友不動産','テレビ東京','リクシル（LIXIL）','小田急電鉄','毎日放送（MBS）','伊那食品工業','コマツ','ヒューリック','ネスレ日本','積水化学工業',
      '福岡ソフトバンクホークス','日清製粉','バンダイナムコフィルムワークス','霧島酒造','カネカ','LDH','松竹','七十七銀行','ByteDance','サンフレッチェ広島',
      // 251-300
      'NVIDIA','ヤマト運輸','高島屋','アビームコンサルティング','三越伊勢丹HD','ENEOS','キオクシア','京成電鉄','小野薬品工業','サミー',
      'ライオン','東京都交通局','日本生活協同組合連合会（生協）','三浦工業','JFEホールディングス','ゼンリン','出光興産','中国電力','三菱UFJフィナンシャル・グループ','インテル',
      '徳洲会','ドン・キホーテ','名古屋鉄道（名鉄）','商船三井','損害保険ジャパン','サンテレビジョン','国土交通省','財務省','JCB','伊藤商事',
      'オリンパス','アスクル','クラレ','JICA','TSMC','ポケモン','ロート製薬','小学館','パソナ','学研ホールディングス',
      '国立国会図書館','ニコン','沖縄電力','奥村組','四国電力','レーザーテック','スペースX','ユニセフ','日本食研ホールディングス','関西テレビ放送'
    ];

    // アーキタイプ定義（rank:必要市場価値ランク, k:難易度係数）
    const archetypes = {
      A1: { rank: 'A', k: 1.15 },
      A2: { rank: 'A', k: 1.15 },
      A3: { rank: 'B', k: 1.10 },
      A4: { rank: 'C', k: 1.00 },
      A5: { rank: 'C', k: 1.00 },
      A6: { rank: 'C', k: 1.05 },
      A7: { rank: 'B', k: 1.10 },
      A8: { rank: 'B', k: 1.05 },
    };

    // 企業→アーキタイプ割当（全300社）
    const companyToArch = {
      // 1-50
      'トヨタ自動車':'A3','グーグル':'A1','ソニー':'A1','楽天グループ':'A8','キーエンス':'A3','任天堂':'A6','パナソニック':'A3','アマゾンジャパン':'A1','Apple Japan':'A1','伊藤忠商事':'A2',
      '三菱商事':'A2','ソフトバンク':'A8','本田技研工業（Honda）':'A3','味の素':'A4','全日本空輸（ANA）':'A5','サントリーホールディングス':'A4','東日本電信電話（NTT東日本）':'A5','ファーストリテイリング':'A4','西日本電信電話（NTT西日本）':'A5','日本航空（JAL）':'A5',
      '日本マイクロソフト':'A1','リクルートホールディングス':'A8','LINEヤフー':'A8','オリエンタルランド':'A6','東日本旅客鉄道（JR東日本）':'A5','三井物産':'A2','資生堂':'A4','明治':'A4','イオン':'A4','アクセンチュア':'A2',
      '東海旅客鉄道（JR東海）':'A5','カゴメ':'A4','日立製作所':'A3','NTTドコモ':'A3','花王':'A4','NTTデータ':'A8','日本電気（NEC）':'A3','電通':'A6','富士通':'A3','東京海上日動火災保険':'A2',
      'バンダイナムコホールディングス':'A6','デンソー':'A3','三井不動産':'A4','バンダイ':'A6','KDDI':'A3','未来工業':'A3','JTB':'A6','フジテレビジョン':'A6','武田薬品工業':'A7','日本たばこ産業（JT）':'A4',
      // 51-100
      '丸紅':'A2','JR西日本':'A5','ニトリ':'A4','東芝':'A3','NRI（野村総合研究所）':'A2','ZOZO':'A8','富士フイルム':'A7','良品計画':'A4','IBM Japan':'A1','キヤノン':'A3',
      'カルビー':'A4','三菱UFJ銀行':'A2','東京エレクトロン':'A1','村田製作所':'A3','日本中央競馬会（JRA）':'A5','AGC':'A3','サイバーエージェント':'A8','日産自動車':'A3','オムロン':'A3','旭化成':'A7',
      '三菱地所':'A4','スターバックス コーヒー ジャパン':'A4','三菱電機':'A3','日本コカ・コーラ':'A4','キリンホールディングス':'A4','TOTO':'A3','タニタ':'A4','DeNA':'A8','積水ハウス':'A4','ゴールドマン・サックス':'A2',
      'アステラス製薬':'A7','集英社':'A6','日本郵船':'A5','日本テレビ（NTV）':'A6','みずほ銀行':'A2','クボタ':'A3','住友商事':'A2','サンリオ':'A6','三菱重工':'A3','第一三共':'A7',
      '日本銀行':'A2','三井住友銀行':'A2','スクウェア・エニックス':'A6','サイボウズ':'A8','清水建設':'A5','アサヒビール':'A4','シャープ':'A3','博報堂':'A6','マツダ':'A3','鹿島建設':'A5',
      // 101-150
      'しまむら':'A4','セガサミーHD':'A6','NHK':'A5','日本製鉄':'A3','キユーピー':'A4','大林組':'A5','江崎グリコ':'A4','ローソン':'A4','大成建設':'A5','京セラ':'A3',
      'テスラ':'A1','ウォルト・ディズニー・ジャパン':'A6','OpenAI':'A1','大和ハウス工業':'A4','ヤクルト本社':'A4','東京都庁':'A5','ヤマハ':'A3','ブルボン':'A4','スズキ':'A3','Meta':'A1',
      '竹中工務店':'A5','メルカリ':'A8','アイシン':'A3','SUBARU':'A3','キッコーマン':'A4','マッキンゼー':'A2','ファナック':'A3','東レ':'A3','中外製薬':'A7','九州電力':'A5',
      '講談社':'A6','野村證券':'A2','タカラトミー':'A6','ベネッセコーポレーション':'A6','信越化学':'A3','日清食品':'A4','ロッテ':'A4','セイコーエプソン':'A3','阪神タイガース':'A6','不二家':'A4',
      'ダイキン工業':'A3','コナミグループ':'A6','日本マクドナルド':'A4','アイリスオーヤマ':'A4','日本生命保険':'A2','コクヨ':'A4','日本赤十字社':'A5','JR九州':'A5','ニデック':'A3','デロイトトーマツコンサルティング':'A2',
      // 151-200
      '森永製菓':'A4','セブン-イレブン・ジャパン':'A4','日本郵便':'A5','JAXA':'A5','SCSK':'A8','コーセー':'A4','P&Gジャパン':'A4','キリンビール':'A4','山崎製パン':'A4','川崎重工':'A3',
      'TOPPAN':'A3','Sky（スカイ）':'A8','日本ガイシ':'A3','IHI':'A3','ファンケル':'A4','伊藤園':'A4','阪急電鉄':'A5','大塚製薬':'A7','サッポロビール':'A4','吉本興業HD':'A6',
      '住友林業':'A4','タミヤ':'A6','森ビル':'A4','三菱ケミカル':'A7','コストコ':'A4','TBS':'A6','ジャパネットたかた':'A6','読売ジャイアンツ':'A6','佐川急便':'A5','東京メトロ':'A5',
      'ユニバーサルミュージック':'A6','東宝':'A6','第一生命':'A2','マツモトキヨシ':'A4','東北電力':'A5','島津製作所':'A7','ダイハツ工業':'A3','モンベル':'A6','エーザイ':'A7','HIS':'A6',
      'Alphabet':'A1','Nike Japan':'A4','ファミリーマート':'A4','PwC':'A2','BCG':'A2','テレビ朝日':'A6','レゴジャパン':'A6','日本オラクル':'A1','北海道電力':'A5','関西電力':'A5',
      // 201-250
      'マイナビ':'A8','MIXI':'A8','大創産業（ダイソー）':'A4','東京電力':'A5','すかいらーくHD':'A4','大日本印刷':'A3','ヤマハ発動機':'A3','東急電鉄':'A5','横浜DeNAベイスターズ':'A6','ルイ・ヴィトン・ジャパン':'A4',
      '刀':'A6','コーエーテクモHD':'A6','ワコール':'A4','オリックス':'A2','塩野義製薬':'A7','シマノ':'A3','ミツカン':'A4','中部電力':'A5','ディスコ':'A3','星野リゾート':'A6',
      '湖池屋':'A4','ANYCOLOR':'A6','NTTコミュニケーションズ':'A3','日本通運':'A5','経済産業省':'A5','理化学研究所':'A5','中国銀行（中銀）':'A2','帝国ホテル':'A6','リコー':'A3','西日本鉄道':'A5',
      '住友不動産':'A4','テレビ東京':'A6','リクシル（LIXIL）':'A3','小田急電鉄':'A5','毎日放送（MBS）':'A6','伊那食品工業':'A4','コマツ':'A3','ヒューリック':'A4','ネスレ日本':'A4','積水化学工業':'A3',
      '福岡ソフトバンクホークス':'A6','日清製粉':'A4','バンダイナムコフィルムワークス':'A6','霧島酒造':'A4','カネカ':'A3','LDH':'A6','松竹':'A6','七十七銀行':'A2','ByteDance':'A1','サンフレッチェ広島':'A6',
      // 251-300
      'NVIDIA':'A1','ヤマト運輸':'A5','高島屋':'A4','アビームコンサルティング':'A2','三越伊勢丹HD':'A4','ENEOS':'A5','キオクシア':'A1','京成電鉄':'A5','小野薬品工業':'A7','サミー':'A6',
      'ライオン':'A4','東京都交通局':'A5','日本生活協同組合連合会（生協）':'A5','三浦工業':'A3','JFEホールディングス':'A3','ゼンリン':'A6','出光興産':'A5','中国電力':'A5','三菱UFJフィナンシャル・グループ':'A2','インテル':'A1',
      '徳洲会':'A7','ドン・キホーテ':'A4','名古屋鉄道（名鉄）':'A5','商船三井':'A5','損害保険ジャパン':'A2','サンテレビジョン':'A6','国土交通省':'A5','財務省':'A5','JCB':'A2','伊藤商事':'A2',
      'オリンパス':'A3','アスクル':'A4','クラレ':'A3','JICA':'A5','TSMC':'A1','ポケモン':'A6','ロート製薬':'A7','小学館':'A6','パソナ':'A6','学研ホールディングス':'A6',
      '国立国会図書館':'A5','ニコン':'A3','沖縄電力':'A5','奥村組':'A5','四国電力':'A5','レーザーテック':'A1','スペースX':'A1','ユニセフ':'A5','日本食研ホールディングス':'A4','関西テレビ放送':'A6'
    };

    const rankToNeeded = { A:80, B:70, C:60, D:50, E:40, F:30 };

    // 企業→業種マッピング
    const companyToIndustry = {
      // IT・通信
      'グーグル':'IT・通信','ソニー':'IT・通信','楽天グループ':'IT・通信','LINEヤフー':'IT・通信','日本マイクロソフト':'IT・通信','NTTドコモ':'IT・通信','NTTデータ':'IT・通信','KDDI':'IT・通信','サイバーエージェント':'IT・通信','DeNA':'IT・通信','ZOZO':'IT・通信','サイボウズ':'IT・通信','メルカリ':'IT・通信','SCSK':'IT・通信','Sky（スカイ）':'IT・通信','マイナビ':'IT・通信','MIXI':'IT・通信','NTTコミュニケーションズ':'IT・通信','テスラ':'IT・通信','OpenAI':'IT・通信','Meta':'IT・通信','Alphabet':'IT・通信','日本オラクル':'IT・通信','ByteDance':'IT・通信','NVIDIA':'IT・通信','キオクシア':'IT・通信','インテル':'IT・通信','TSMC':'IT・通信','レーザーテック':'IT・通信','スペースX':'IT・通信','東日本電信電話（NTT東日本）':'IT・通信','西日本電信電話（NTT西日本）':'IT・通信','IBM Japan':'IT・通信','Apple Japan':'IT・通信','アマゾンジャパン':'IT・通信','ソフトバンク':'IT・通信',
      // 製造業・自動車
      'トヨタ自動車':'製造業・自動車','本田技研工業（Honda）':'製造業・自動車','日産自動車':'製造業・自動車','マツダ':'製造業・自動車','スズキ':'製造業・自動車','SUBARU':'製造業・自動車','ダイハツ工業':'製造業・自動車','キーエンス':'製造業・自動車','パナソニック':'製造業・自動車','日立製作所':'製造業・自動車','日本電気（NEC）':'製造業・自動車','富士通':'製造業・自動車','東芝':'製造業・自動車','キヤノン':'製造業・自動車','村田製作所':'製造業・自動車','東京エレクトロン':'製造業・自動車','オムロン':'製造業・自動車','三菱電機':'製造業・自動車','シャープ':'製造業・自動車','セイコーエプソン':'製造業・自動車','京セラ':'製造業・自動車','ファナック':'製造業・自動車','アイシン':'製造業・自動車','ヤマハ':'製造業・自動車','ヤマハ発動機':'製造業・自動車','川崎重工':'製造業・自動車','IHI':'製造業・自動車','コマツ':'製造業・自動車','リコー':'製造業・自動車','JFEホールディングス':'製造業・自動車','三浦工業':'製造業・自動車','デンソー':'製造業・自動車','日本製鉄':'製造業・自動車','日本ガイシ':'製造業・自動車','島津製作所':'製造業・自動車','ディスコ':'製造業・自動車','ニデック':'製造業・自動車','オリンパス':'製造業・自動車','ニコン':'製造業・自動車','クラレ':'製造業・自動車','AGC':'製造業・自動車','クボタ':'製造業・自動車','未来工業':'製造業・自動車','バンダイ':'製造業・自動車','タカラトミー':'製造業・自動車','タミヤ':'製造業・自動車','シマノ':'製造業・自動車','積水化学工業':'製造業・自動車','カネカ':'製造業・自動車','TOPPAN':'製造業・自動車','大日本印刷':'製造業・自動車',
      // 金融・保険
      '三菱UFJ銀行':'金融・保険','みずほ銀行':'金融・保険','三井住友銀行':'金融・保険','日本銀行':'金融・保険','野村證券':'金融・保険','ゴールドマン・サックス':'金融・保険','第一生命':'金融・保険','日本生命保険':'金融・保険','損害保険ジャパン':'金融・保険','オリックス':'金融・保険','三菱UFJフィナンシャル・グループ':'金融・保険','JCB':'金融・保険','七十七銀行':'金融・保険','中国銀行（中銀）':'金融・保険','東京海上日動火災保険':'金融・保険',
      // 商社・流通
      '伊藤忠商事':'商社・流通','三菱商事':'商社・流通','三井物産':'商社・流通','丸紅':'商社・流通','住友商事':'商社・流通','日本郵船':'商社・流通','商船三井':'商社・流通','日本通運':'商社・流通','ヤマト運輸':'商社・流通','佐川急便':'商社・流通','伊藤商事':'商社・流通',
      // 食品・飲料
      '味の素':'食品・飲料','サントリーホールディングス':'食品・飲料','カゴメ':'食品・飲料','カルビー':'食品・飲料','日本コカ・コーラ':'食品・飲料','キリンホールディングス':'食品・飲料','アサヒビール':'食品・飲料','キユーピー':'食品・飲料','江崎グリコ':'食品・飲料','キッコーマン':'食品・飲料','日清食品':'食品・飲料','ロッテ':'食品・飲料','不二家':'食品・飲料','森永製菓':'食品・飲料','キリンビール':'食品・飲料','山崎製パン':'食品・飲料','サッポロビール':'食品・飲料','ブルボン':'食品・飲料','伊藤園':'食品・飲料','大塚製薬':'食品・飲料','ミツカン':'食品・飲料','湖池屋':'食品・飲料','日清製粉':'食品・飲料','霧島酒造':'食品・飲料','ライオン':'食品・飲料','明治':'食品・飲料','ヤクルト本社':'食品・飲料',
      // 建設・不動産
      '三井不動産':'建設・不動産','三菱地所':'建設・不動産','清水建設':'建設・不動産','鹿島建設':'建設・不動産','大林組':'建設・不動産','大成建設':'建設・不動産','竹中工務店':'建設・不動産','大和ハウス工業':'建設・不動産','積水ハウス':'建設・不動産','住友林業':'建設・不動産','森ビル':'建設・不動産','住友不動産':'建設・不動産','ヒューリック':'建設・不動産','奥村組':'建設・不動産',
      // メディア・エンターテインメント
      '任天堂':'メディア・エンターテインメント','オリエンタルランド':'メディア・エンターテインメント','バンダイナムコホールディングス':'メディア・エンターテインメント','電通':'メディア・エンターテインメント','JTB':'メディア・エンターテインメント','フジテレビジョン':'メディア・エンターテインメント','集英社':'メディア・エンターテインメント','日本テレビ（NTV）':'メディア・エンターテインメント','サンリオ':'メディア・エンターテインメント','スクウェア・エニックス':'メディア・エンターテインメント','セガサミーHD':'メディア・エンターテインメント','ウォルト・ディズニー・ジャパン':'メディア・エンターテインメント','講談社':'メディア・エンターテインメント','タカラトミー':'メディア・エンターテインメント','ベネッセコーポレーション':'メディア・エンターテインメント','阪神タイガース':'メディア・エンターテインメント','コナミグループ':'メディア・エンターテインメント','吉本興業HD':'メディア・エンターテインメント','TBS':'メディア・エンターテインメント','ジャパネットたかた':'メディア・エンターテインメント','読売ジャイアンツ':'メディア・エンターテインメント','ユニバーサルミュージック':'メディア・エンターテインメント','東宝':'メディア・エンターテインメント','モンベル':'メディア・エンターテインメント','HIS':'メディア・エンターテインメント','テレビ朝日':'メディア・エンターテインメント','レゴジャパン':'メディア・エンターテインメント','横浜DeNAベイスターズ':'メディア・エンターテインメント','刀':'メディア・エンターテインメント','コーエーテクモHD':'メディア・エンターテインメント','ANYCOLOR':'メディア・エンターテインメント','帝国ホテル':'メディア・エンターテインメント','テレビ東京':'メディア・エンターテインメント','毎日放送（MBS）':'メディア・エンターテインメント','福岡ソフトバンクホークス':'メディア・エンターテインメント','バンダイナムコフィルムワークス':'メディア・エンターテインメント','LDH':'メディア・エンターテインメント','松竹':'メディア・エンターテインメント','サンフレッチェ広島':'メディア・エンターテインメント','ポケモン':'メディア・エンターテインメント','サミー':'メディア・エンターテインメント','ゼンリン':'メディア・エンターテインメント','サンテレビジョン':'メディア・エンターテインメント','関西テレビ放送':'メディア・エンターテインメント','博報堂':'メディア・エンターテインメント','NHK':'メディア・エンターテインメント','小学館':'メディア・エンターテインメント','学研ホールディングス':'メディア・エンターテインメント',
      // 医薬品・化学
      '武田薬品工業':'医薬品・化学','富士フイルム':'医薬品・化学','旭化成':'医薬品・化学','アステラス製薬':'医薬品・化学','第一三共':'医薬品・化学','中外製薬':'医薬品・化学','大塚製薬':'医薬品・化学','三菱ケミカル':'医薬品・化学','エーザイ':'医薬品・化学','塩野義製薬':'医薬品・化学','小野薬品工業':'医薬品・化学','徳洲会':'医薬品・化学','ロート製薬':'医薬品・化学','信越化学':'医薬品・化学','東レ':'医薬品・化学',
      // サービス・コンサル
      'アクセンチュア':'サービス・コンサル','NRI（野村総合研究所）':'サービス・コンサル','マッキンゼー':'サービス・コンサル','デロイトトーマツコンサルティング':'サービス・コンサル','PwC':'サービス・コンサル','BCG':'サービス・コンサル','アビームコンサルティング':'サービス・コンサル','リクルートホールディングス':'サービス・コンサル','パソナ':'サービス・コンサル',
      // 小売・流通
      'ファーストリテイリング':'小売・流通','イオン':'小売・流通','ニトリ':'小売・流通','良品計画':'小売・流通','しまむら':'小売・流通','ローソン':'小売・流通','セブン-イレブン・ジャパン':'小売・流通','ファミリーマート':'小売・流通','日本マクドナルド':'小売・流通','コストコ':'小売・流通','マツモトキヨシ':'小売・流通','ドン・キホーテ':'小売・流通','大創産業（ダイソー）':'小売・流通','すかいらーくHD':'小売・流通','高島屋':'小売・流通','三越伊勢丹HD':'小売・流通','ルイ・ヴィトン・ジャパン':'小売・流通','アスクル':'小売・流通','スターバックス コーヒー ジャパン':'小売・流通','Nike Japan':'小売・流通',
      // 運輸・物流
      '全日本空輸（ANA）':'運輸・物流','日本航空（JAL）':'運輸・物流','東日本旅客鉄道（JR東日本）':'運輸・物流','東海旅客鉄道（JR東海）':'運輸・物流','JR西日本':'運輸・物流','JR九州':'運輸・物流','東京メトロ':'運輸・物流','東急電鉄':'運輸・物流','小田急電鉄':'運輸・物流','京成電鉄':'運輸・物流','西日本鉄道':'運輸・物流','名古屋鉄道（名鉄）':'運輸・物流','阪急電鉄':'運輸・物流','東京都交通局':'運輸・物流','日本郵便':'運輸・物流',
      // エネルギー
      '九州電力':'エネルギー','東北電力':'エネルギー','北海道電力':'エネルギー','関西電力':'エネルギー','東京電力':'エネルギー','中部電力':'エネルギー','沖縄電力':'エネルギー','四国電力':'エネルギー','中国電力':'エネルギー','ENEOS':'エネルギー','出光興産':'エネルギー',
      // 化粧品・日用品
      '資生堂':'化粧品・日用品','花王':'化粧品・日用品','コーセー':'化粧品・日用品','P&Gジャパン':'化粧品・日用品','ファンケル':'化粧品・日用品','タニタ':'化粧品・日用品','コクヨ':'化粧品・日用品','ワコール':'化粧品・日用品','リクシル（LIXIL）':'化粧品・日用品','アイリスオーヤマ':'化粧品・日用品',
      // 製造業・自動車（追加）
      '三菱重工':'製造業・自動車','ダイキン工業':'製造業・自動車','TOTO':'製造業・自動車','日本たばこ産業（JT）':'製造業・自動車',
      // 食品・飲料（追加）
      '伊那食品工業':'食品・飲料','ネスレ日本':'食品・飲料','日本食研ホールディングス':'食品・飲料',
      // 商社・流通（追加）
      '日本中央競馬会（JRA）':'商社・流通','日本生活協同組合連合会（生協）':'商社・流通',
      // サービス・コンサル（追加）
      '星野リゾート':'サービス・コンサル',
      // 公的機関
      '東京都庁':'公的機関','日本赤十字社':'公的機関','JAXA':'公的機関','経済産業省':'公的機関','理化学研究所':'公的機関','国土交通省':'公的機関','財務省':'公的機関','JICA':'公的機関','国立国会図書館':'公的機関','ユニセフ':'公的機関',
    };

    // 質問ごとの点数（新しい質問に合わせて更新）
    const questionPoints = {
      Q1:[0,2,4,6,8], // 年齢
      Q2:[0,4,6,8,10,6], // 職種
      Q3:[0,3,6,8,10], // 役職
      Q4:[0,3,5,7,9,10], // 年収
      Q5:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14], // 業種（点数は使用しない、業種判定のみ）
      Q6:[0,2,4,6,8,10], // 成果
      Q7:[0,1,2,3,4,5,6,7], // 月間売上
      Q8:[0,4,7,10], // 業務範囲
      Q9:[0,2,4,5], // 意思決定
      Q10:[0,1,2,3,4], // 在籍年数
      Q11:[0,1,2,3,4], // 転職回数（少ない方が高評価）
      Q12:[1,2,3,4,5], // 学歴
      Q13:[0,1,2], // 資格
      Q14:[0,2,4,5], // チャレンジ精神
      Q15:[0,2,4,5], // ストレス耐性
      Q16:[0,2,4,5], // 主体性・責任感
      Q17:[0,2,4,5], // デジタルスキル
      Q18:[0,2,4,6,8,10], // プロジェクト管理経験
      Q19:[0,2,4,5], // 調整・交渉
      Q20:[0,2,4,5], // 学習意欲・成長志向
    };

    function calcScores(answers) {
      const get = (id) => {
        const val = answers[id];
        if (!val) return 0;
        const opts = questions.find(q => q.id === id)?.options || [];
        const idx = opts.indexOf(val);
        const ptsArr = questionPoints[id] || [];
        return ptsArr[idx] ?? 0;
      };
      // 新しい質問構成に合わせて再マッピング
      // 職務経験: Q6(成果) + Q7(数値説明) + Q8(業務範囲) + Q9(意思決定) + Q10(在籍年数) + Q18(プロジェクト管理)
      // Q5は業種判定用なのでスコア計算から除外
      const S_exp = get('Q6')+get('Q7')+get('Q8')+get('Q9')+get('Q10')+get('Q18');
      // 年収役職: Q3(役職) + Q4(年収) + Q11(転職回数、逆転)
      const S_income = get('Q3')+get('Q4')+(4-get('Q11')); // 転職回数は少ない方が高評価
      // スキル汎用性: Q17(デジタル) + Q19(調整・交渉)
      // Q18は職務経験に移動したので除外
      const S_skill = get('Q17')+get('Q19');
      // マインド: Q14(チャレンジ精神) + Q15(ストレス耐性) + Q16(主体性・責任感)
      const S_mind = get('Q14')+get('Q15')+get('Q16');
      // 学歴資格: Q12(学歴) + Q13(資格)
      const S_academic = get('Q12')+get('Q13');
      // 人物特性: Q20(学習意欲)
      const S_person = get('Q20');
      // 正規化（最大値を調整）
      const 職務経験 = (S_exp / 46) * 40; // 最大46点想定（Q6:10 + Q7:7 + Q8:10 + Q9:5 + Q10:4 + Q18:10）
      const 年収役職 = (S_income / 30) * 20; // 最大30点想定
      const スキル汎用性 = (S_skill / 10) * 15; // 最大10点想定（Q17:5 + Q19:5、Q18は職務経験に移動）
      const マインド = (S_mind / 15) * 15; // 最大15点想定（Q14:5 + Q15:5 + Q16:5）
      const 学歴資格 = (S_academic / 7) * 5; // 最大7点想定
      const 人物特性 = (S_person / 5) * 5; // 最大5点想定
      const total = 職務経験 + 年収役職 + スキル汎用性 + マインド + 学歴資格 + 人物特性;
      return { total, axes: [職務経験, 年収役職, スキル汎用性, マインド, 学歴資格 + 人物特性] };
    }

    function sigmoid(x){ return 1/(1+Math.exp(-x)); }

    function computeProb(marketValue, archKey, name, userIndustry){
      const arch = archetypes[archKey] || archetypes.A4;
      const needed = rankToNeeded[arch.rank] || 60;
      const gap = marketValue - needed * arch.k;
      // ばらつき用バイアス（社名から決定的に生成）
      const seed = (name.charCodeAt(0) + name.length * 17) % 17; // 0-16
      const bias = (seed - 8) * 0.12; // -0.96〜0.96
      // 基本分布: 10〜60%レンジ、95%が10〜30%に収まるように調整
      const base = 10 + 20 * sigmoid((gap + bias*3.5) / 2.8); // おおむね10〜30%
      // 微細揺らぎ（±2%程度）
      const micro = bias * 2.5;
      // 高スコアの尾を持ち上げるボーナス（gap>10で発動）、最大60%まで
      const bonus = gap > 10 ? Math.min(30, ((gap - 10) / 2.5) * (1 + bias * 0.3)) : 0;
      // 業種一致時の11.3%加点
      const companyIndustry = companyToIndustry[name];
      const industryBonus = (userIndustry && companyIndustry && userIndustry === companyIndustry) ? 11.3 : 0;
      let prob = base + micro + bonus + industryBonus;
      
      // 10%ちょうどの場合は9.5%〜10.5%の範囲で完全ランダムに抽選
      if (Math.abs(prob - 10) < 0.01) { // 10%に近い場合（誤差0.01%以内）
        prob = 9.5 + Math.random() * 1.0; // 9.5〜10.5の範囲でランダム
      } else {
        prob = Math.min(60, Math.max(10, prob)); // 10〜60%の範囲に制限
      }
      
      return prob;
    }

    function generateResults(scores, answers){
      const marketValue = scores.total;
      const userIndustry = answers['Q5']; // Q5は業種
      return companies.map((name) => {
        const arch = companyToArch[name] || 'A4';
        const prob = computeProb(marketValue, arch, name, userIndustry);
        return { name, prob };
      }).sort((a,b)=> b.prob - a.prob || a.name.localeCompare(b.name));
    }

    // 4段階の色判定（閾値は実際の%: 10〜60%スケール）
    function colorByProb(p) {
      if (p >= 40) return ['#22c55e', 'GREEN'];
      if (p >= 25) return ['#eab308', 'YELLOW'];
      if (p >= 15) return ['#f97316', 'ORANGE'];
      return ['#ef4444', 'RED'];
    }



    // フォーム描画
    let step = 0;
    const answers = {};
    const errors = {};
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const formArea = document.getElementById('form-area');
    const errorMessage = document.getElementById('error-message');

    function setProgress() {
      const answered = Math.min(step, questions.length);
      const pct = Math.round((answered / questions.length) * 100);
      progressBar.style.width = `${pct}%`;
      progressText.textContent = `${answered}/${questions.length} (${pct}%)`;
    }

    function renderQuestion() {
      if (step > questions.length) step = questions.length;
      setProgress();
      const q = questions[step];
      if (!q) {
        const scores = calcScores(answers);
        const results = generateResults(scores, answers);
        // 結果をlocalStorageに保存して結果ページへ遷移
        localStorage.setItem('diagnosticResults', JSON.stringify({ scores, results, answers }));
        window.location.href = 'career-probability-result.html';
        return;
      }
      const selected = answers[q.id];
      const err = errors[q.id] || '';
      formArea.innerHTML = `
        <div class="question-card">
          <div class="question-title">${q.title}</div>
          <div class="options">
            ${q.options.map(opt => {
              const active = selected === opt ? 'active' : '';
              return `<div class="opt ${active}" data-val="${opt}">${opt}</div>`;
            }).join('')}
          </div>
          ${err ? `<div class="error" style="margin-top:6px;">${err}</div>` : ''}
          <div class="nav">
            <button class="btn btn-secondary" id="prev" ${step === 0 ? 'disabled' : ''}>戻る</button>
            <button class="btn btn-primary" id="next">${step === questions.length - 1 ? '結果を見る' : '次へ'}</button>
          </div>
        </div>
      `;
      formArea.querySelectorAll('.opt').forEach(el => {
        el.addEventListener('click', () => {
          answers[q.id] = el.dataset.val;
          errors[q.id] = '';
          if (step < questions.length - 1) {
            step += 1;
          } else {
            step = questions.length;
          }
          renderQuestion();
        });
      });
      formArea.querySelector('#prev').addEventListener('click', () => {
        step = Math.max(0, step - 1);
        renderQuestion();
      });
      formArea.querySelector('#next').addEventListener('click', () => {
        if (!answers[q.id]) {
          errors[q.id] = '選択してください';
          renderQuestion();
          return;
        }
        errors[q.id] = '';
        if (step < questions.length - 1) {
          step += 1;
        } else {
          step = questions.length;
        }
        renderQuestion();
      });
    }

    function renderQuestionCompletion(scores){
      formArea.innerHTML = `
        <div class="question-card" style="text-align:center;">
          <div class="question-title">診断完了！ 結果を計算中...</div>
          <div style="margin-top:8px; color:#6b7280;">結果ページへ遷移します</div>
        </div>
      `;
    }

    // 初期描画（質問から開始）
    renderQuestion();
  </script>
</body>
</html>
