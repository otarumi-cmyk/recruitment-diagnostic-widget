<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>想定年収診断</title>
  <style>
    :root {
      --bg: #f8f7f4;
      --panel: #ffffff;
      --border: #e9e5dd;
      --primary: #ff6b03;
      --primary-2: #ffa347;
      --text: #1f2933;
      --muted: #6b7280;
      --radius: 16px;
      --font: 'Inter', 'Noto Sans JP', system-ui, -apple-system, sans-serif;
      --shadow: 0 16px 40px rgba(0,0,0,0.10);
      --shadow-soft: 0 8px 20px rgba(0,0,0,0.06);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font);
      background: radial-gradient(circle at 20% 20%, rgba(255,107,3,0.07), transparent 26%),
                  radial-gradient(circle at 80% 0%, rgba(255,163,71,0.08), transparent 22%),
                  var(--bg);
      color: var(--text);
      padding: 24px;
    }
    .shell {
      max-width: 1080px;
      margin: 0 auto;
      display: grid;
      gap: 20px;
    }
    .hero {
      padding: 24px 28px;
      background: linear-gradient(135deg, rgba(255,107,3,0.10), rgba(255,163,71,0.10));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
    }
    .hero h1 { margin: 0 0 8px; font-size: 24px; letter-spacing: 0.01em; }
    .hero p { margin: 4px 0; color: var(--muted); font-size: 14px; }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 20px;
    }
    .progress-wrap { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .progress { flex: 1; height: 10px; background: #f4ede5; border-radius: 999px; overflow: hidden; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--primary-2)); transition: width 0.2s ease; }
    .progress-text { font-size: 13px; color: var(--muted); min-width: 110px; text-align: right; }
    .question-card {
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: #fffaf5;
    }
    .question-title { margin: 0 0 8px; font-weight: 700; font-size: 17px; }
    .question-desc { margin: 0 0 16px; font-size: 13px; color: var(--muted); }
    .options { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; margin-bottom: 16px; }
    .opt {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #ffffff;
      cursor: pointer;
      transition: all 0.15s ease;
      color: var(--text);
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
      text-align: left;
      font-size: 14px;
    }
    .opt:hover { border-color: var(--primary); transform: translateY(-1px); box-shadow: 0 6px 14px rgba(255,107,3,0.12); }
    .opt.active { border-color: var(--primary); background: #fff2e7; box-shadow: 0 6px 14px rgba(255,107,3,0.18); color: #7a2f00; font-weight: 600; }
    .nav { display: flex; justify-content: space-between; gap: 10px; margin-top: 12px; }
    .btn {
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s ease;
      font-size: 14px;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: #fff;
      box-shadow: 0 10px 24px rgba(255,107,3,0.26);
    }
    .btn-primary:hover { filter: brightness(1.05); transform: translateY(-1px); }
    .btn-secondary {
      background: #fff;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    .btn-secondary[disabled] { opacity: 0.4; cursor: default; }
    .error { color: #ef4444; font-size: 13px; margin-top: 6px; }
    .input-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .input-row input[type="number"] {
      flex: 0 0 140px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 14px;
    }
    .input-row span { font-size: 14px; color: var(--muted); }
    .helper-text { font-size: 12px; color: var(--muted); }
    @media (max-width: 640px) {
      body { padding: 16px; }
      .hero { padding: 18px; }
      .options { grid-template-columns: 1fr; }
      .btn { width: 100%; text-align: center; }
      .nav { flex-direction: column; }
      .progress-text { min-width: 72px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="hero">
      <h1>想定年収診断</h1>
      <p>現在の年収とスキルから、転職時の想定年収をかんたん診断します（目安値）。</p>
    </div>

    <div class="panel">
      <div class="progress-wrap">
        <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="progress-text" id="progress-text">0/10 (0%)</div>
      </div>
      <div id="error-message" class="error" style="display:none;"></div>
      <div id="form-area"></div>
    </div>
  </div>

  <script type="module">
    const questions = [
      {
        id: 'Q1',
        type: 'input',
        title: '現在の年収（額面）を教えてください',
        desc: '税込の年収を「万円」単位で入力してください（例：450 → 450万円）。',
      },
      {
        id: 'Q2',
        title: '現在の職種はどれに該当しますか',
        options: ['一般事務・アシスタント', '営業・セールス', 'マーケティング・企画・PdM', 'IT・エンジニア', 'AI・データ・高度専門職', 'その他専門職']
      },
      {
        id: 'Q3',
        title: '現在の役職・職位はどれに該当しますか',
        options: ['一般職', 'リーダー・主任', 'マネージャー', '部長・ディレクター', '事業責任者・役員']
      },
      {
        id: 'Q4',
        title: 'プログラミング・デジタルツールの活用経験は',
        options: ['ほぼ使えない', 'Excel・Wordなど一般ツール', '業務改善でツールを活用', 'プログラミング・AI活用で成果を出している']
      },
      {
        id: 'Q5',
        title: 'プロジェクト管理・推進経験は？',
        options: ['経験なし', '小規模プロジェクト（3名以下）', '中規模プロジェクト（5〜10名）', '大規模プロジェクト（10名以上）', '複数プロジェクトを同時管理', '事業レベルのプロジェクトを主導']
      },
      {
        id: 'Q6',
        title: '過去1年間で達成した具体的な成果はありますか',
        options: ['成果なし', '定性的な成果のみ', '一部で数値目標を達成', '主要な数値目標を達成', '数値目標を大幅に達成']
      },
      {
        id: 'Q7',
        title: '月間の売り上げは？（売上に関与していない場合は「なし」を選択）',
        options: ['なし（売上に関与していない）', '30万円未満', '30万円〜50万円', '50万円〜100万円', '100万円〜200万円', '200万円〜500万円', '500万円〜1000万円', '1000万円以上']
      },
      {
        id: 'Q8',
        title: '担当している業務の範囲は',
        options: ['単一業務のみ', '複数業務を担当', '部門横断プロジェクトに参加', '事業全体に関わる業務']
      },
      {
        id: 'Q9',
        title: '業務上の意思決定権限はどの程度ありますか',
        options: ['指示された業務を実行', '一部の業務で自律判断', '担当領域で意思決定', '戦略レベルの意思決定']
      },
      {
        id: 'Q10',
        title: '保有している資格は（最も当てはまるもの）',
        options: ['資格なし', 'TOEIC（700点以上）・簿記2級・基本情報技術者など', '税理士・公認会計士・弁護士・医師・薬剤師・中小企業診断士・社会保険労務士・行政書士・宅建士など']
      }
    ];

    const scoreMap = {
      Q2: [0, 4, 6, 8, 10, 6],
      Q3: [0, 3, 6, 8, 10],
      Q4: [0, 2, 4, 5],
      Q5: [0, 2, 4, 6, 8, 10],
      Q6: [0, 2, 4, 6, 8],
      Q7: [0, 1, 2, 3, 4, 5, 6, 7],
      Q8: [0, 4, 7, 10],
      Q9: [0, 2, 4, 5],
      Q10: [0, 1, 2]
    };

    const MAX_SCORE = 60; // 設計時の目安スコア

    function calcScore(answers) {
      let total = 0;
      for (const [qid, arr] of Object.entries(scoreMap)) {
        const q = questions.find(q => q.id === qid);
        if (!q) continue;
        const val = answers[qid];
        if (!val) continue;
        const idx = q.options.indexOf(val);
        if (idx >= 0 && arr[idx] != null) total += arr[idx];
      }
      return total;
    }

    function buildResultPayload(answers) {
      const rawIncome = Number(answers.Q1);
      const baseIncome = isFinite(rawIncome) && rawIncome > 0 ? rawIncome : 0; // 万円
      const score = calcScore(answers);
      const rate = Math.max(0, Math.min(1, score / MAX_SCORE));
      const addAmount = 50 + rate * 150; // 50〜200万円
      const estimated = baseIncome + addAmount;

      return {
        answers,
        baseIncome,
        score,
        addAmount,
        estimated,
      };
    }

    let step = 0;
    const answers = {};
    const errors = {};
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const formArea = document.getElementById('form-area');
    const globalError = document.getElementById('error-message');

    function setProgress() {
      const answered = Math.min(step + 1, questions.length);
      const pct = Math.round((answered / questions.length) * 100);
      progressBar.style.width = `${pct}%`;
      progressText.textContent = `${answered}/${questions.length} (${pct}%)`;
    }

    function goResult() {
      const payload = buildResultPayload(answers);
      try {
        const dataStr = JSON.stringify(payload);
        const encoded = btoa(encodeURIComponent(dataStr));
        localStorage.setItem('salaryEstimationResult', dataStr);
        window.location.href = `salary-estimation-result.html?data=${encoded}`;
      } catch (e) {
        console.error(e);
        globalError.textContent = '結果の計算中にエラーが発生しました。時間をおいて再度お試しください。';
        globalError.style.display = 'block';
      }
    }

    function renderQuestion() {
      globalError.style.display = 'none';
      if (step < 0) step = 0;
      if (step >= questions.length) step = questions.length - 1;
      setProgress();

      const q = questions[step];
      const selected = answers[q.id];
      const err = errors[q.id] || '';

      let bodyHtml = '';
      if (q.type === 'input') {
        const val = selected ?? '';
        bodyHtml = `
          <div class="question-title">${q.title}</div>
          <p class="question-desc">${q.desc}</p>
          <div class="input-row">
            <input type="number" id="income-input" min="50" max="10000" step="10" value="${val !== undefined ? val : ''}" placeholder="例）450" />
            <span>万円</span>
          </div>
          <div class="helper-text">※ おおよその金額で構いません。50〜10,000万円の範囲で入力してください。</div>
        `;
      } else {
        bodyHtml = `
          <div class="question-title">${q.title}</div>
          <div class="options">
            ${q.options.map(opt => {
              const active = selected === opt ? 'active' : '';
              return `<div class="opt ${active}" data-val="${opt}">${opt}</div>`;
            }).join('')}
          </div>
        `;
      }

      formArea.innerHTML = `
        <div class="question-card">
          ${bodyHtml}
          ${err ? `<div class="error">${err}</div>` : ''}
          <div class="nav">
            <button class="btn btn-secondary" id="prev" ${step === 0 ? 'disabled' : ''}>戻る</button>
            <button class="btn btn-primary" id="next">${step === questions.length - 1 ? '結果を見る' : '次へ'}</button>
          </div>
        </div>
      `;

      if (q.type === 'input') {
        const input = document.getElementById('income-input');
        input.addEventListener('input', () => {
          errors[q.id] = '';
        });
      } else {
        formArea.querySelectorAll('.opt').forEach(el => {
          el.addEventListener('click', () => {
            answers[q.id] = el.dataset.val;
            errors[q.id] = '';
            if (step < questions.length - 1) {
              step += 1;
              renderQuestion();
            } else {
              // 最後の質問は選択したらそのまま結果画面へ
              goResult();
            }
          });
        });
      }

      formArea.querySelector('#prev').addEventListener('click', () => {
        if (step > 0) {
          step -= 1;
          renderQuestion();
        }
      });

      formArea.querySelector('#next').addEventListener('click', () => {
        if (q.type === 'input') {
          const input = document.getElementById('income-input');
          const val = Number(input.value);
          if (!input.value || !isFinite(val) || val < 50 || val > 10000) {
            errors[q.id] = '50〜10,000の範囲で年収（万円）を入力してください。';
            renderQuestion();
            return;
          }
          answers[q.id] = val;
        } else if (!answers[q.id]) {
          errors[q.id] = '選択してください。';
          renderQuestion();
          return;
        }

        errors[q.id] = '';

        if (step < questions.length - 1) {
          step += 1;
          renderQuestion();
        } else {
          goResult();
        }
      });
    }

    renderQuestion();
  </script>
</body>
</html>

